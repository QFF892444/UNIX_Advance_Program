# 习题
# 第三章

3.1 所有的磁盘 I/O 都要经过内核的块缓存区（也称为内核的缓冲区高速缓存）。唯一例外的是对原始磁盘设备 I/O，但是我们不考虑这种情况。既     然 read 或 write 的数据都要被内核缓冲，则术语"不带缓冲的 I/O"指的是在用户的进程中对这两个函数不会自动缓冲，每次 read 或        write 就要进行一次系统调用。

3.2 见源程序 dup2_no_fcntl.c

3.3 每次调用open函数就分配一个新的文件表项。但是因为两次打开的是同一个文件，则两个文件表项指向相同的 v 节点。
    图略。

3.4 如果 fd 是1，执行 dup2(fd, 1) 后返回1，但没有关闭文件描述符1，调用三次 dup2后，3个描述符指向相同的文件表项，所以不需要关闭描述符。如果 fd 是3，调用3次 dup2 后，有4个描述符指向相同的文件表项，这种情况下就需要关闭描述符3。

3.5 因为 shell 从左到右处理命令行，所以
    ./a/out > outfile 2>&1
    首先设置标准输出到outfile，然后执行 dup 将标准输出复制到描述符2上，其结果是将标准输出和标准错误设置为同一文件，即描述符1和2指向同一个文件表项。而命令行

    ./a.out 2 > &1 >outfile
    由于首先执行 dup，所以描述符2成为终端，标准输出重定向到 outfile。结果是描述符1指向outfile的文件表项，描述符2指向终端的文件表项。

3.6 仍然可以使用 lseek 和 read 函数读文件中任意一个位置的内容，但是 write 函数在写数据钱会自动将文件偏移量设置为文件尾，所以写文件时只能从文件尾端开始。